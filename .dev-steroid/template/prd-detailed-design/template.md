# 詳細設計書
> 本書は「実装/テストが迷わない」粒度を目標とする。曖昧さは残さず、決め切れない場合は未決として明示する（推測で埋めない）。
> **全セクション必須**。該当しない場合は「該当なし」と記載し、セクション自体は削除しない。
## 0. サマリ
- 対象範囲：
- 前提：
- 重要な設計判断（Design decisions）：
## 1. モジュール/コンポーネント分割
| モジュール | 役割 | 主要I/F | 依存 | 状態/責務 | 備考 |
|---|---|---|---|---|---|
## 2. 主要フロー（シーケンス）
> 各フローは「入力→処理→出力」を明確に。分岐条件と例外を列挙する。
### 2.1 フロー一覧
| Flow-ID | 対象（画面ID/IF-ID/FR-ID） | 概要 | 備考 |
|---|---|---|---|
### 2.2 代表フロー詳細（Flow-IDごと）
#### Flow-xxx
- トリガー：
- 前提条件：
- 入力：
- 処理手順（擬似コード/箇条書き）：
- 出力：
- 分岐条件：
- 例外/エラー：
- ログ/監査：
## 3. API/IF 詳細
> 仕様追加にならない範囲で、要件/基本設計の内容を“具体”に落とす。
### 3.1 エンドポイント仕様
#### IF-xxx
- Method / Path：
- 認証/認可：
- リクエスト（フィールド/型/必須/制約）：
- レスポンス（成功/失敗）：
- バリデーション：
- 主なエラー（コード/条件）：
- べき等性/リトライ：
## 4. 例外/エラー設計
- 想定エラー一覧（内部/外部/入力）：
- エラーコード/メッセージ方針：
- リトライ/フォールバック：
- ユーザー通知/運用通知の方針：
## 5. トランザクション/整合性
- トランザクション境界：
- 整合性要件：
- 競合/排他：
- 冪等性：
## 6. 観測性（Observability）
- ログ（レベル/必須項目/PIIマスキング）：
- メトリクス（主要指標）：
- トレース：
## 7. 未決・TODO
-
## 8. レビューステータス
- AIレビュー：未実施 / reviewed / 指摘あり
- ユーザー承認：未承認 / approved
- 備考：

<!-- generation_hints:
- **ファイル分割必須**: 本テンプレートはエントリポイント（index.md）として使用する。以下の単位でサブファイルに分割し、エントリポイントからリンクする:
  - 機能/モジュール単位（例: `auth-flow.md`, `recipe-crud.md`, `search-engine.md`）
  - API/IF が多い場合はドメイン単位（例: `api-user.md`, `api-recipe.md`）
  - 複雑なフローは独立ファイル（例: `flow-payment.md`）
- エントリポイント（index.md）には「0. サマリ」「1. モジュール/コンポーネント分割」を残し、2〜6 は各サブファイルに分割する
- 各サブファイルの冒頭に「対象モジュール」「関連 FR-ID / Flow-ID」を明記し、単独で読んでも文脈がわかるようにする
- Flow-ID / IF-ID を採番し、要件（FR/AC）と対応付ける
- 主要フローは「入力→処理→出力」「分岐条件」「例外」を必ず明示し、実装者が迷わない粒度にする
- API/IF 詳細は、入出力フィールド/制約/エラー条件がテストに落ちるレベルまで具体化する（仕様追加は禁止）
-->
<!-- review_criteria:
- Flow-ID / IF-ID が整合し、要件（FR/AC）からのトレースが成立している
- 主要フローに分岐/例外/入力検証が明記され、実装者が迷わない粒度になっている
- エラー設計（条件/コード/通知）が具体的で、テストに落ちる
-->
